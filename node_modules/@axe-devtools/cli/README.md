# @axe-devtools/cli

A JavaScript API and Command Line Application (CLI) for fetching and scanning web pages for accessibility issues using the axe DevTool rules engine.

Currently only the default WCAG 2.0 AA rule set will be run, using the Firefox browser by default, or else whichever browser is passed into the initialize function.

## Prerequisites

@axe-devtools/cli requires:

- node.js version 6.4 or later
- Firefox or Chrome

The application will run on MacOS, Linux or Windows.

## Setup

The application can be installed globally using npm, using Deque Systems virtual npm repository.
See your axe DevTool documentation for how to authenticate with the repository.

```sh
npm install -g @axe-devtools/cli --registry https://agora.dequecloud.com/artifactory/api/npm/devtools-npm
```

Once installed, the application can be accessed using the `axe` shell command.

## CLI

There are two modes of operation:

- URI Mode. This allows a single page to be fetched and analyzed, with the resulting output sent to a file or to the standard-output. When using the URI mode, it is highly suggested you use the `-j` or `--compat` flag. The flag enables `@axe-devtools/reporter` compatible output.

- Spec Mode. This will fetch a sequence of pages, based on a specification file, with output going to
  a directory.

You can use custom axe source with the `--axe-source` argument with either mode.

You can specify a custom ruleset with the `--custom` argument with either mode, but the behavior is
slightly different between modes.

- URI Mode: Applies the custom ruleset.

- Spec Mode: Sets the custom ruleset to the file but does not apply it by default. Use the `analyze with a custom ruleset` directive to use the ruleset when analyzing.

In URI mode you can use the ruleset default for whatever version of axe you are using (rather than
`wcag2`) with the `--source-default-ruleset` argument. Spec mode can do the same with a special
directive for the analyze action.

You can choose to launch the browser in headless mode with the `--headless` argument.

There are two configuration modes to update settings:

- Selenium Settings `axe config-selenium` - This will display the current Selenium settings and allow changes to be made to
  those settings from the CLI.

### Debugging @axe-devtools/cli

@axe-devtools/cli will conditionally log verbose messages to `stderr` via [`debug`](http://npmjs.com/debug). To enable this debugging, set the `DEBUG` environment variable to `"cli:*"`.

### Examples of use

#### URI Mode:

Fetching a single page with output going to the std-out console.

```sh
axe https://example.com/page.html
```

Fetching a multiple pages with output going to the std-out console.

```sh
axe https://example.com/home.html https://example.com/about.html
```

Fetching a single page with output going to a file.

```sh
axe https://example.com/page.html --save=./myoutput.json
```

Fetching a single page and analyze using custom axe source

```sh
axe https://example.com/page.html --axe-source axe-2.5.2.min.js
```

#### Spec Mode:

Fetching multiple pages from a specification file, with output going to a specified directory:

```sh
axe spec ./pages.json ./myoutput
```

Validate spec file without executing

```sh
axe spec ./pages.json --validate
```

#### Reporter Mode:

Consume the results in ./axe-devtools-results and output a HTML report in ./axe-devtools_output

```sh
axe reporter ./axe-devtools-results --destination=./axe-devtools_output --format=html
```

Consume the results in ./axe-devtools-results and output an XML report in the default directory

```sh
axe reporter ./axe-devtools-results --format=xml
```

Consume the results in ./axe-devtools-results and output a CSV report in the default directory

```sh
axe reporter ./axe-devtools-results --format=csv
```

#### Ruleset Mode:

Generating a default ruleset without customizations

```sh
axe ruleset --<508, wcag2, wcag21>
```

Generating all the default rulesets without customizations

```sh
axe ruleset build
```

Generating a custom ruleset based on WCAG

```sh
axe ruleset --tags wcag2a wcag2aa wcag21a wcag21aa --custom <dir>
```

Generating a custom ruleset and a changelog spreadsheet based on Section 508 and specify the output directory

```sh
axe ruleset --tags section508 --custom <dir> --destination <dir> --log true
```

Generate a ruleset and include all rules, not just those in the `rules` property

```sh
axe ruleset --wcag2a --disable-rules false
```

#### Configure Selenium:

Viewing/changing the Selenium settings:

```sh
axe config-selenium
```

## Specification File

Spec files contain a 'projects' object array. Each project should contain
a name, id, and pageList object array. Each pageList object should contain
the page name and URL.

Example:

```json
{
  "projects": [
    {
      "name": "axe core",
      "id": "axe-core",
      "pageList": [
        {
          "name": "axe Homepage",
          "url": "https://axe-core.org/"
        },
        {
          "name": "Integrations",
          "url": "https://axe-core.org/examples/"
        },
        {
          "name": "About axe",
          "url": "https://axe-core.org/about/"
        }
      ]
    },
    {
      "name": "Mars Commuter",
      "id": "mars-commuter",
      "pageList": [
        {
          "name": "homepage",
          "url": "https://dequeuniversity.com/demo/mars/"
        }
      ]
    }
  ]
}
```
